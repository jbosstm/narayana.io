<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Transactions</title>
<style>
@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";
@import "https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css";

h6 > .content > .title,h7,h8,h9 {
    font-family:"Open Sans","DejaVu Sans",sans-serif;
    font-weight:normal;
    font-size:.85em;
    font-style:normal;
    color:#ba8425;
    text-rendering:optimizeLegibility;
    margin-top:1em;
    margin-bottom:1em;
    line-height:2em
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Transactions</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_the_java_transaction_api_jakarta_transactions">The Java Transaction API (Jakarta Transactions)</a></li>
<li><a href="#_introducing_the_api">Introducing the API</a></li>
<li><a href="#usertransaction_definition">UserTransaction</a></li>
<li><a href="#_transactionmanager">TransactionManager</a></li>
<li><a href="#_suspend_and_resuming_a_transaction">Suspend and resuming a transaction</a></li>
<li><a href="#_the_transaction_interface">The Transaction interface</a></li>
<li><a href="#_resource_enlistment">Resource enlistment</a></li>
<li><a href="#_transaction_synchronization">Transaction synchronization</a></li>
<li><a href="#_transaction_equality">Transaction equality</a></li>
<li><a href="#_transactionsynchronizationregistry">TransactionSynchronizationRegistry</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A transaction is a unit of work that encapsulates multiple database actions such that that either all the encapsulated actions fail or all succeed.</p>
</div>
<div class="paragraph">
<p>Transactions ensure data integrity when an application interacts with multiple datasources.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_java_transaction_api_jakarta_transactions"><a class="anchor" href="#_the_java_transaction_api_jakarta_transactions"></a>The Java Transaction API (Jakarta Transactions)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The interfaces specified by the many transaction standards tend to be too low-level for most application programmers.
Therefore, Sun Microsystems created the Java Transaction API (JTA), which specifies higher-level interfaces to assist in the development of distributed transactional applications.
JTA was later renamed Jakarta Transactions and the specification is maintained at <a href="https://jakarta.ee/specifications/transactions" class="bare">https://jakarta.ee/specifications/transactions</a>.</p>
</div>
<div class="paragraph">
<p>Note, these interfaces are still low-level.
You still need to implement state management and concurrency for transactional applications.
The interfaces are also optimized for applications which require XA resource integration capabilities, rather than the more general resources which other transactional APIs allow.</p>
</div>
<div class="paragraph">
<p>With reference to Jakarta Transactions (<a href="https://jakarta.ee/specifications/transactions/" class="bare">https://jakarta.ee/specifications/transactions/</a>), distributed transaction services typically involve a number of participants:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">provides the infrastructure required to support the application run-time environment which includes transaction state management, such as an EJB server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">transaction manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">provides the services and management functions required to support transaction demarcation, transactional resource management, synchronization, and transaction context propagation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using a <em>resource adapter</em>, provides the application with access to resources.
The resource manager participates in distributed transactions by implementing a transaction resource interface used by the transaction manager to communicate transaction association, transaction completion and recovery.</p>
<p class="tableblock">A resource adapter is used by an application server or client to connect to a Resource Manager.
JDBC drivers which are used to connect to relational databases are examples of Resource Adapters.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">communication resource manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">supports transaction context propagation and access to the transaction service for incoming and outgoing requests.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>From the point of view of the transaction manager, the actual implementation of the transaction services does not need to be exposed.
You only need to define high-level interfaces to allow transaction demarcation, resource enlistment, synchronization and recovery process to be driven from the users of the transaction services.
Jakarta Transactions is a high-level application interface that allows a transactional application to demarcate transaction boundaries, and also contains a mapping of the X/Open XA protocol.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Compatibility</div>
<div class="paragraph">
<p>the Jakarta Transactions support provided by Narayana is compliant with the 1.1 specification.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introducing_the_api"><a class="anchor" href="#_introducing_the_api"></a>Introducing the API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Java Transaction API consists of three elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a high-level application transaction demarcation interface</p>
</li>
<li>
<p>a high-level transaction manager interface intended for application server</p>
</li>
<li>
<p>a standard Java mapping of the X/Open XA protocol intended for a transactional resource manager.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of the Jakarta Transactions classes and interfaces exist within the <code>jakarta.transaction</code> package, and the corresponding Narayana implementations within the <code>com.arjuna.ats.jta</code> package.
Note that XA resource API classes are still part of the Java SE (<a href="https://jakarta.ee/specifications/transactions/2.0/jakarta-transactions-spec-2.0.html#relationship-to-other-java-apis" class="bare">https://jakarta.ee/specifications/transactions/2.0/jakarta-transactions-spec-2.0.html#relationship-to-other-java-apis</a>)</p>
</div>
<div class="paragraph">
<p>Each Xid created by Narayana needs a unique node identifier encoded within it, because Narayana can only recover transactions and states that match a specified node identifier.
The node identifier to use should be provided to Narayana via the <code>CoreEnvironmentBean.nodeIdentifier</code> property.
This value must be unique across your Narayana instances.
The identifier is alphanumeric and limited to 10 bytes in length.
If you do not provide a value, then Narayana generates one and reports the value via the logging infrastructure.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usertransaction_definition"><a class="anchor" href="#usertransaction_definition"></a>UserTransaction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>UserTransaction</code> interface provides applications with the ability to control transaction boundaries.
It provides methods <code>begin</code>, <code>commit</code>, and <code>rollback</code> to operate on top-level transactions.</p>
</div>
<div class="paragraph">
<p>Nested transactions are not supported, and method <code>begin</code> throws the exception <code>NotSupportedException</code> if the calling thread is already associated with a transaction.
<code>UserTransaction</code> automatically associates newly created transactions with the invoking thread.</p>
</div>
<div class="paragraph">
<p>To obtain a <code>UserTransaction</code>, call the static method <code>com.arjuna.ats.jta.UserTransaction.userTransaction()</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Selecting the local Jakarta Transactions Implementation</div>
<ol class="arabic">
<li>
<p>Set property <code>JTAEnvironmentBean.jtaTMImplementation</code> to `com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionManagerImple `.</p>
</li>
<li>
<p>Set property <code>JTAEnvironmentBean.jtaUTImplementation</code> to <code>com.arjuna.ats.internal.jta.transaction.arjunacore.UserTransactionImple</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transactionmanager"><a class="anchor" href="#_transactionmanager"></a>TransactionManager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>TransactionManager</code> interface allows the application server to control transaction boundaries on behalf of the application being managed.</p>
</div>
<div class="paragraph">
<p>To obtain a <code>TransactionManager</code>, invoke the static method <code>com.arjuna.ats.jta.TransactionManager.transactionManager</code>.</p>
</div>
<div class="paragraph">
<p>The <code>TransactionManager</code> maintains the transaction context association with threads as part of its internal data structure.
A thread&#8217;s transaction context may be <code>null</code> or it may refer to a specific global transaction.
Multiple threads may be associated with the same global transaction.
As noted in <a href="#usertransaction_definition">UserTransaction</a>, nested transactions are not supported.</p>
</div>
<div class="paragraph">
<p>Each transaction context is encapsulated by a Transaction object, which can be used to perform operations which are specific to the target transaction, regardless of the calling thread&#8217;s transaction context.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. `TransactionManager`Methods</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>begin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starts a new top-level transaction and associates the transaction context with the calling thread.
If the calling thread is already associated with a transaction, exception <code>NotSupportedException</code> is thrown.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getTransaction</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the Transaction object representing the transaction context which is currently associated with the calling thread.
You can use this object to perform various operations on the target transaction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>commit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Completes the transaction currently associated with the calling thread.
After it returns, the calling thread is associated with no transaction.
If <code>commit</code> is called when the thread is not associated with any transaction context, an exception is thrown.
In some implementations, the <code>commit</code> operation is restricted to the transaction originator only.
If the calling thread is not allowed to commit the transaction, an exception is thrown.
Narayana does not currently impose any restriction on the ability of threads to terminate transactions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rollback</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rolls back the transaction associated with the current thread.
After the <code>rollback</code> method completes, the thread is associated with no transaction.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In a multi-threaded environment, multiple threads may be active within the same transaction.
If checked transaction semantics have been disabled, or the transaction times out, a transaction may terminated by a thread other than the one that created it.
In this case, the creator usually needs to be notified.
Narayana notifies the creator during operations <code>commit</code> or <code>rollback</code> by throwing exception <code>IllegalStateException</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_suspend_and_resuming_a_transaction"><a class="anchor" href="#_suspend_and_resuming_a_transaction"></a>Suspend and resuming a transaction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jakarta Transactions supports the concept of a thread temporarily suspending and resuming transactions in order to perform non-transactional work.
Call the <code>suspend</code> method to temporarily suspend the current transaction that is associated with the calling thread.
The thread then operates outside of the scope of the transaction.
If the thread is not associated with any transaction, a <code>null</code> object reference is returned.
Otherwise, a valid <code>Transaction</code> object is returned.
Pass the <code>Transaction</code> object to the <code>resume</code> method to reinstate the transaction context.</p>
</div>
<div class="paragraph">
<p>The <code>resume</code> method associates the specified transaction context with the calling thread.
If the transaction specified is not a valid transaction, the thread is associated with no transaction.
if <code>resume</code> is invoked when the calling thread is already associated with another transaction, the <code>IllegalStateException</code> exception is thrown.</p>
</div>
<div class="listingblock">
<div class="title">Using the `suspend`method</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Transaction tobj = TransactionManager.suspend();
..
        TransactionManager.

resume(tobj);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Narayana allows a suspended transaction to be resumed by a different thread.
This feature is not required by Jakarta Transactions, but is an important feature.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a transaction is suspended, the application server must ensure that the resources in use by the application are no longer registered with the suspended transaction.
When a resource is de-listed this triggers the Transaction Manager to inform the resource manager to disassociate the transaction from the specified resource object.
When the application&#8217;s transaction context is resumed, the application server must ensure that the resources in use by the application are again enlisted with the transaction.
Enlisting a resource as a result of resuming a transaction triggers the Transaction Manager to inform the resource manager to re-associate the resource object with the resumed transaction.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_transaction_interface"><a class="anchor" href="#_the_transaction_interface"></a>The Transaction interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>Transaction</code> interface allows you to perform operations on the transaction associated with the target object.
Every top-level transaction is associated with one <code>Transaction</code> object when the transaction is created.</p>
</div>
<div class="ulist">
<div class="title">Uses of the `Transaction`object</div>
<ul>
<li>
<p>enlist the transactional resources in use by the application.</p>
</li>
<li>
<p>register for transaction synchronization call backs.</p>
</li>
<li>
<p>commit or rollback the transaction.</p>
</li>
<li>
<p>obtain the status of the transaction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>commit</code> and <code>rollback</code> methods allow the target object to be committed or rolled back.
The calling thread does not need to have the same transaction associated with the thread.
If the calling thread is not allowed to commit the transaction, the transaction manager throws an exception.
At present Narayana does not impose restrictions on threads terminating transactions.</p>
</div>
<div class="paragraph">
<p>Jakarta Transactions does not provide a means to obtain the transaction identifier.
However, Narayana provides several ways to view the transaction identifier.
Call method <code>toString</code> to print full information about the transaction, including the identifier.
Alternatively you can cast the <code>jakarta.transaction.Transaction</code> instance to a <code>com.arjuna.ats.jta.transaction.Transaction</code>, then call either method <code>get_uid</code>, which returns an ArjunaCore <code>Uid</code> representation, or <code>getTxId</code>, which returns an <code>Xid</code> for the global identifier, i.e., no branch qualifier.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resource_enlistment"><a class="anchor" href="#_resource_enlistment"></a>Resource enlistment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Typically, an application server manages transactional resources, such as database connections, in conjunction with some resource adapter and optionally with connection pooling optimization.
For an external transaction manager to coordinate transactional work performed by the resource managers, the application server must enlist and de-list the resources used in the transaction.
These resources, called <em>participants</em>, are enlisted with the transaction so that they can be informed when the transaction terminates, by being driven through the two-phase commit protocol.</p>
</div>
<div class="paragraph">
<p>As stated previously, Jakarta Transactions is much more closely integrated with the XA concept of resources than the arbitrary objects.
For each resource the application is using, the application server invokes the <code>enlistResource</code> method with an <code>XAResource</code> object which identifies the resource in use.</p>
</div>
<div class="paragraph">
<p>The enlistment request causes the transaction manager to inform the resource manager to start associating the transaction with the work performed through the corresponding resource.
The transaction manager passes the appropriate flag in its <code>XAResource.start</code> method call to the resource manager.</p>
</div>
<div class="paragraph">
<p>The <code>delistResource</code> method disassociates the specified resource from the transaction context in the target object.
The application server invokes the method with the two parameters: the <code>XAResource</code> object that represents the resource, and a flag to indicate whether the operation is due to the transaction being suspended (<code>TMSUSPEND</code>), a portion of the work has failed (<code>TMFAIL</code>), or a normal resource release by the application (<code>TMSUCCESS</code>).</p>
</div>
<div class="paragraph">
<p>The de-list request causes the transaction manager to inform the resource manager to end the association of the transaction with the target <code>XAResource</code>. The flag value allows the application server to indicate whether it intends to come back to the same resource whereby the resource states must be kept intact.
The transaction manager passes the appropriate flag value in its <code>XAResource.end</code> method call to the underlying resource manager.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transaction_synchronization"><a class="anchor" href="#_transaction_synchronization"></a>Transaction synchronization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Transaction synchronization allows the application server to be notified before and after the transaction completes.
For each transaction started, the application server may optionally register a <code>Synchronization</code> call-back object to be invoked by the transaction manager, which will be one of the following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>beforeCompletion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Called before the start of the two-phase transaction complete process.
This call is executed in the same transaction context of the caller who initiates the <code>TransactionManager.commit</code> or the call is executed with no transaction context if <code>Transaction.commit</code> is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>afterCompletion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Called after the transaction completes.
The status of the transaction is supplied in the parameter.
This method is executed without a transaction context.</p>
<p class="tableblock">NOTE: If an XAResource throws a RuntimeException, this method will not be called as the transaction has not and cannot complete.
Please see JBTM-2148 for more details.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_transaction_equality"><a class="anchor" href="#_transaction_equality"></a>Transaction equality</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The transaction manager implements the <code>Transaction</code> object&#8217;s <code>equals</code> method to allow comparison between the target object and another <code>Transaction</code> object.
The <code>equals</code> method returns <code>true</code> if the target object and the parameter object both refer to the same global transaction.</p>
</div>
<div class="listingblock">
<div class="title">Method <code>equals</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Transaction txObj = TransactionManager.getTransaction();
Transaction someOtherTxObj = ..
        ..

boolean isSame = txObj.equals(someOtherTxObj);      </code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transactionsynchronizationregistry"><a class="anchor" href="#_transactionsynchronizationregistry"></a>TransactionSynchronizationRegistry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>jakarta.transaction.TransactionSynchronizationRegistry</code> interface, added to the Jakarta Transactions API in version 1.1, provides for registering Synchronizations with special ordering behavior, and for storing key-value pairs in a per-transaction Map.
Full details are available in the Jakarta Transactions API specification and javadoc.
Here we focus on implementation specific behavior.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Accessing the <code>TransactionSynchronizationRegistry</code> in standalone environments</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jakarta.transaction.TransactionSynchronizationRegistry tsr = <span class="keyword">new</span> com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionSynchronizationRegistryImple();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a stateless object and hence is cheap to instantiate.</p>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Accessing the TransactionSynchronizationRegistry via JNDI</div>
<p>In application server environments, the standard JNDI name binding is <code>java:comp/TransactionSynchronizationRegistry</code>.</p>
</div>
<div class="paragraph">
<p>Ordering of interposed Synchronizations is relative to other local Synchronizations only.
In cases where the transaction is distributed over multiple JVMs, global ordering is not guaranteed.</p>
</div>
<div class="paragraph">
<p>The per-transaction data storage provided by the <code>TransactionSynchronizationRegistry</code> methods <code>getResource</code> and <code>putResource</code> are non-persistent and thus not available in <code>Transactions</code> during crash recovery.
When running integrated with an application server or other container, this storage may be used for system purposes.
To avoid collisions, use an application-specific prefix on map keys, such as <code>put("myapp_"+key, value)</code>.
The behavior of the <code>Map</code> on <code>Thread</code> s that have status <code>NO_TRANSACTION</code> or where the transaction they are associated with has been rolled back by another <code>Thread</code>, such as in the case of a timeout, is undefined.
A <code>Transaction</code> can be associated with multiple <code>Thread`s.
For such cases the `Map</code> is synchronized to provide thread safety.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-10-16 15:47:44 +0200
</div>
</div>
</body>
</html>