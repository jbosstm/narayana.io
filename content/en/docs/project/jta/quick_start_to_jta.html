<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Quick Start to JTA</title>
<style>
@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";
@import "https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css";

h6 > .content > .title,h7,h8,h9 {
    font-family:"Open Sans","DejaVu Sans",sans-serif;
    font-weight:normal;
    font-size:.85em;
    font-style:normal;
    color:#ba8425;
    text-rendering:optimizeLegibility;
    margin-top:1em;
    margin-bottom:1em;
    line-height:2em
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Quick Start to JTA</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_package_layout">Package layout</a></li>
<li><a href="#_setting_properties">Setting properties</a>
<ul class="sectlevel2">
<li><a href="#_specifying_the_object_store_location">Specifying the object store location</a></li>
</ul>
</li>
<li><a href="#_demarcating_transactions">Demarcating Transactions</a>
<ul class="sectlevel2">
<li><a href="#_usertransaction">UserTransaction</a></li>
<li><a href="#_transactionmanager">TransactionManager</a></li>
<li><a href="#_the_transaction_interface">The Transaction interface</a></li>
</ul>
</li>
<li><a href="#_local_vs_distributed_jta_implementations">Local vs Distributed JTA implementations</a></li>
<li><a href="#_jdbc_and_transactions">JDBC and Transactions</a></li>
<li><a href="#_configurable_options">Configurable options</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter will briefly cover the key features required to construct a JTA application.
It is assumed that the reader is familiar with the concepts of the JTA.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_package_layout"><a class="anchor" href="#_package_layout"></a>Package layout</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The key Java packages (and corresponding jar files) for writing basic JTA applications are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>com.arjuna.ats.jts</code>: this package contains the Narayana implementations of the JTS and JTA.</p>
</li>
<li>
<p><code>com.arjuna.ats.jta</code>: this package contains local and remote JTA implementation support.</p>
</li>
<li>
<p><code>com.arjuna.ats.jdbc</code>: this package contains transactional JDBC support.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of these packages appear in the lib directory of the Narayana installation, and should be added to the programmer’s <code>CLASSPATH</code>.</p>
</div>
<div class="paragraph">
<p>In order to fully utilize all of the facilities available within Narayana, it will be necessary to add some additional jar files to your classpath.
See bin/setup-env.sh or bin\setup-env.bat for details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_properties"><a class="anchor" href="#_setting_properties"></a>Setting properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Narayana has also been designed to be configurable at runtime through the use of various property attributes.
These attributes can be provided at runtime on command line or specified through a properties file.</p>
</div>
<div class="sect2">
<h3 id="_specifying_the_object_store_location"><a class="anchor" href="#_specifying_the_object_store_location"></a>Specifying the object store location</h3>
<div class="paragraph">
<p>Narayana requires an object store in order to persistently record the outcomes of transactions in the event of failures.
In order to specify the location of the object store it is necessary to specify the location when the application is executed; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">java –DObjectStoreEnvironmentBean.objectStoreDir=/var/tmp/ObjectStore myprogram</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default location is a directory under the current execution directory.</p>
</div>
<div class="paragraph">
<p>By default, all object states will be stored within the defaultStore subdirectory of the object store root, e.g., <code>/usr/local/Arjuna/TransactionService/ObjectStore/defaultStore</code>.
However, this subdirectory can be changed by setting the <code>ObjectStoreEnvironmentBean.localOSRoot</code> property variable accordingly.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_demarcating_transactions"><a class="anchor" href="#_demarcating_transactions"></a>Demarcating Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Java Transaction API consists of three elements: a high-level application transaction demarcation interface, a high-level transaction manager interface intended for application server, and a standard Java mapping of the X/Open XA protocol intended for transactional resource manager.
All of the JTA classes and interfaces occur within the <code>jakarta.transaction</code> package, and the corresponding Narayana implementations within the <code>com.arjuna.ats.jta package</code>.</p>
</div>
<div class="sect2">
<h3 id="_usertransaction"><a class="anchor" href="#_usertransaction"></a>UserTransaction</h3>
<div class="paragraph">
<p>The UserTransaction interface provides applications with the ability to control transaction boundaries.</p>
</div>
<div class="paragraph">
<p>In Narayana, <code>UserTransaction</code> can be obtained from the static <code>com.arjuna.ats.jta.UserTransaction.userTransaction()</code> method.
When obtained the <code>UserTransaction</code> object can be used to control transactions</p>
</div>
<div class="listingblock">
<div class="title">User Transaction Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//get UserTransaction</span>
UserTransaction utx = com.arjuna.ats.jta.UserTransaction.userTransaction();
<span class="comment">// start transaction work..</span>
utx.begin();

<span class="comment">// perform transactional work</span>
utx.commit();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_transactionmanager"><a class="anchor" href="#_transactionmanager"></a>TransactionManager</h3>
<div class="paragraph">
<p>The TransactionManager interface allows the application server to control transaction boundaries on behalf of the application being managed.</p>
</div>
<div class="paragraph">
<p>In Narayana, transaction manager implementations can be obtained from the static <code>com.arjuna.ats.jta.TransactionManager.transactionManager()</code> method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_transaction_interface"><a class="anchor" href="#_the_transaction_interface"></a>The Transaction interface</h3>
<div class="paragraph">
<p>The Transaction interface allows operations to be performed on the transaction associated with the target object.
Every top-level transaction is associated with one Transaction object when the transaction is created.
The Transaction object can be used to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>enlist the transactional resources in use by the application.</p>
</li>
<li>
<p>register for transaction synchronization call backs.</p>
</li>
<li>
<p>commit or rollback the transaction.</p>
</li>
<li>
<p>obtain the status of the transaction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A Transaction object can be obtained using the <code>TransactionManager</code> by invoking the method <code>getTransaction()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Transaction txObj = TransactionManager.getTransaction();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_local_vs_distributed_jta_implementations"><a class="anchor" href="#_local_vs_distributed_jta_implementations"></a>Local vs Distributed JTA implementations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to ensure interoperability between JTA applications, it is recommended to rely on the JTS/OTS specification to ensure transaction propagation among transaction managers.</p>
</div>
<div class="paragraph">
<p>In order to select the local JTA implementation it is necessary to perform the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>make sure the property <code>JTAEnvironmentBean.jtaTMImplementation</code> is set to <code>com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionManagerImple</code>.</p>
</li>
<li>
<p>make sure the property <code>JTAEnvironmentBean.jtaUTImplementation</code> is set to <code>com.arjuna.ats.internal.jta.transaction.arjunacore.UserTransactionImple</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to select the distributed JTA implementation it is necessary to perform the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>make sure the property <code>JTAEnvironmentBean.jtaTMImplementation</code> is set to <code>com.arjuna.ats.internal.jta.transaction.jts.TransactionManagerImple</code>.</p>
</li>
<li>
<p>make sure the property <code>JTAEnvironmentBean.jtaUTImplementation</code> is set to <code>com.arjuna.ats.internal.jta.transaction.jts.UserTransactionImple</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jdbc_and_transactions"><a class="anchor" href="#_jdbc_and_transactions"></a>JDBC and Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Narayana JTS supports the construction of both local and distributed transactional applications which access databases using the JDBC APIs.
JDBC supports two-phase commit of transactions, and is similar to the XA X/Open standard.
The JDBC support is found in the <code>com.arjuna.ats.jdbc</code> package.</p>
</div>
<div class="paragraph">
<p>The ArjunaJTS approach to incorporating JDBC connections within transactions is to provide transactional JDBC drivers through which all interactions occur.
These drivers intercept all invocations and ensure that they are registered with, and driven by, appropriate transactions.
(There is a single type of transactional driver through which any JDBC driver can be driven.
This driver is <code>com.arjuna.ats.jdbc.TransactionalDriver</code>, which implements the <code>java.sql.Driver</code> interface.)</p>
</div>
<div class="paragraph">
<p>Once the connection has been established (for example, using the <code>java.sql.DriverManager.getConnection</code> method), all operations on the connection will be monitored by Narayana.
Once created, the driver and any connection can be used in the same way as any other JDBC driver or connection.</p>
</div>
<div class="paragraph">
<p>Narayana connections can be used within multiple different transactions simultaneously, i.e., different threads, with different notions of the current transaction, may use the same JDBC connection. Narayana does connection pooling for each transaction within the JDBC connection.
So, although multiple threads may use the same instance of the JDBC connection, internally this may be using a different connection instance per transaction.
With the exception of close, all operations performed on the connection at the application level will only be performed on this transaction-specific connection.</p>
</div>
<div class="paragraph">
<p>Narayana will automatically register the JDBC driver connection with the transaction via an appropriate resource.
When the transaction terminates, this resource will be responsible for either committing or rolling back any changes made to the underlying database via appropriate calls on the JDBC driver.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configurable_options"><a class="anchor" href="#_configurable_options"></a>Configurable options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following table shows some of the configuration features, with default values shown in italics.
For more detailed information, the relevant section numbers are provided.
You should look at the various Programmers Guides for more options.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You need to prefix certain properties in this table with the string <code>com.arjuna.ats.internal.jta.transaction</code>.
The prefix has been removed for formatting reasons, and has been replaced by &#8230;&#8203;</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration Name</th>
<th class="tableblock halign-left valign-top">Possible Values</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.arjuna.ats.jta.supportSubtransactions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>YES</code>/<code>NO</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.arjuna.ats.jta.jtaTMImplementation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#8230;&#8203;arjunacore.TransactionManagerImple</code></p>
<p class="tableblock"><code>&#8230;&#8203;jts.TransactionManagerImple</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.arjuna.ats.jta.jtaUTImplementation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#8230;&#8203;arjunacore.UserTransactionImple</code></p>
<p class="tableblock"><code>&#8230;&#8203;jts.UserTransactionImple</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.arjuna.ats.jta.xaBackoffPeriod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Time in seconds</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.arjuna.ats.jdbc.isolationLevel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Any supported JDBC isolation level.</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-10-16 15:47:44 +0200
</div>
</div>
</body>
</html>