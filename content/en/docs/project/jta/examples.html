<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Examples</title>
<style>
@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";
@import "https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css";

h6 > .content > .title,h7,h8,h9 {
    font-family:"Open Sans","DejaVu Sans",sans-serif;
    font-weight:normal;
    font-size:.85em;
    font-style:normal;
    color:#ba8425;
    text-rendering:optimizeLegibility;
    margin-top:1em;
    margin-bottom:1em;
    line-height:2em
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Examples</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_jdbc_example">JDBC example</a></li>
<li><a href="#_failure_recovery_example_with_basicxarecovery">Failure recovery example with BasicXARecovery</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_jdbc_example"><a class="anchor" href="#_jdbc_example"></a>JDBC example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This simplified example assumes that you are using the transactional JDBC driver provided with Narayana.
For details about how to configure and use this driver see the previous Chapter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">JDBCTest</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {

        <span class="predefined-type">Connection</span> conn = <span class="predefined-constant">null</span>;
        <span class="predefined-type">Connection</span> conn2 = <span class="predefined-constant">null</span>;
        <span class="comment">// non-tx statement</span>
        <span class="predefined-type">Statement</span> stmt = <span class="predefined-constant">null</span>;
        <span class="comment">// will be a tx-statement</span>
        <span class="predefined-type">Statement</span> stmtx = <span class="predefined-constant">null</span>;
        <span class="predefined-type">Properties</span> dbProperties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();

        <span class="keyword">try</span> {
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="content">Creating connection to database: </span><span class="delimiter">&quot;</span></span> + url);

            <span class="comment">/*
             * Create conn and conn2 so that they are bound to the JBossTS
             * transactional JDBC driver. The details of how to do this will
             * depend on your environment, the database you wish to use and
             * whether or not you want to use the Direct or JNDI approach. See
             * the appropriate chapter in the JTA Programmers Guide.
             */</span>

            stmt = conn.createStatement();  <span class="comment">// non-tx statement</span>

            <span class="keyword">try</span> {
                stmt.executeUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">DROP TABLE test_table</span><span class="delimiter">&quot;</span></span>);
                stmt.executeUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">DROP TABLE test_table2</span><span class="delimiter">&quot;</span></span>);
            } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
                <span class="comment">// assume not in database.</span>
            }

            <span class="keyword">try</span> {
                stmt.executeUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE TABLE test_table (a INTEGER,b INTEGER)</span><span class="delimiter">&quot;</span></span>);
                stmt.executeUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE TABLE test_table2 (a INTEGER,b INTEGER)</span><span class="delimiter">&quot;</span></span>);
            } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
            }

            <span class="keyword">try</span> {
                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Starting top-level transaction.</span><span class="delimiter">&quot;</span></span>);

                com.arjuna.ats.jta.UserTransaction.userTransaction().begin();

                stmtx = conn.createStatement(); <span class="comment">// will be a tx-statement</span>

                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="content">Adding entries to table 1.</span><span class="delimiter">&quot;</span></span>);

                stmtx.executeUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO test_table (a, b) VALUES (1,2)</span><span class="delimiter">&quot;</span></span>);

                <span class="predefined-type">ResultSet</span> res1 = <span class="predefined-constant">null</span>;

                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="content">Inspecting table 1.</span><span class="delimiter">&quot;</span></span>);

                res1 = stmtx.executeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM test_table</span><span class="delimiter">&quot;</span></span>);
                <span class="keyword">while</span> (res1.next()) {
                    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Column 1: </span><span class="delimiter">&quot;</span></span> + res1.getInt(<span class="integer">1</span>));
                    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Column 2: </span><span class="delimiter">&quot;</span></span> + res1.getInt(<span class="integer">2</span>));
                }

                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="content">Adding entries to table 2.</span><span class="delimiter">&quot;</span></span>);

                stmtx.executeUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO test_table2 (a, b) VALUES (3,4)</span><span class="delimiter">&quot;</span></span>);
                res1 = stmtx.executeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM test_table2</span><span class="delimiter">&quot;</span></span>);
                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="content">Inspecting table 2.</span><span class="delimiter">&quot;</span></span>);

                <span class="keyword">while</span> (res1.next()) {
                    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Column 1: </span><span class="delimiter">&quot;</span></span> + res1.getInt(<span class="integer">1</span>));
                    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Column 2: </span><span class="delimiter">&quot;</span></span> + res1.getInt(<span class="integer">2</span>));
                }
                <span class="predefined-type">System</span>.out.print(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="content">Now attempting to rollback changes.</span><span class="delimiter">&quot;</span></span>);
                com.arjuna.ats.jta.UserTransaction.userTransaction().rollback();

                com.arjuna.ats.jta.UserTransaction.userTransaction().begin();
                stmtx = conn.createStatement();
                <span class="predefined-type">ResultSet</span> res2 = <span class="predefined-constant">null</span>;

                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="content">Now checking state of table 1.</span><span class="delimiter">&quot;</span></span>);

                res2 = stmtx.executeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM test_table</span><span class="delimiter">&quot;</span></span>);
                <span class="keyword">while</span> (res2.next()) {
                    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Column 1: </span><span class="delimiter">&quot;</span></span> + res2.getInt(<span class="integer">1</span>));
                    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Column 2: </span><span class="delimiter">&quot;</span></span> + res2.getInt(<span class="integer">2</span>));
                }

                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="content">Now checking state of table 2.</span><span class="delimiter">&quot;</span></span>);

                stmtx = conn.createStatement();
                res2 = stmtx.executeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM test_table2</span><span class="delimiter">&quot;</span></span>);
                <span class="keyword">while</span> (res2.next()) {
                    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Column 1: </span><span class="delimiter">&quot;</span></span> + res2.getInt(<span class="integer">1</span>));
                    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Column 2: </span><span class="delimiter">&quot;</span></span> + res2.getInt(<span class="integer">2</span>));
                }

                com.arjuna.ats.jta.UserTransaction.userTransaction().commit(<span class="predefined-constant">true</span>);
            } <span class="keyword">catch</span> (<span class="exception">Exception</span> ex) {
                ex.printStackTrace();
                <span class="predefined-type">System</span>.exit(<span class="integer">0</span>);
            }
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> sysEx) {
            sysEx.printStackTrace();
            <span class="predefined-type">System</span>.exit(<span class="integer">0</span>);
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_failure_recovery_example_with_basicxarecovery"><a class="anchor" href="#_failure_recovery_example_with_basicxarecovery"></a>Failure recovery example with BasicXARecovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This class implements the <code>XAResourceRecovery</code> interface for <code>XAResources</code>.
The parameter supplied in <code>setParameters</code> can contain arbitrary information necessary to initialize the class once created.
In this example, it contains the name of the property file in which the database connection information is specified, as well as the number of connections that this file contains information on.
Each item is separated by a semicolon.</p>
</div>
<div class="paragraph">
<p>This is only a small example of the sorts of things an <code>XAResourceRecovery</code> implementer could do.
This implementation uses a property file that is assumed to contain sufficient information to recreate connections used during the normal run of an application so that recovery can be performed on them.
Typically, user-names and passwords should never be presented in raw text on a production system.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Database parameter format for the properties file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre> DB_x_DatabaseURL=
 DB_x_DatabaseUser=
 DB_x_DatabasePassword=
 DB_x_DatabaseDynamicClass=</pre>
</div>
</div>
<div class="paragraph">
<p><code>x</code> is the number of the connection information.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Some error-handling code is missing from this example, to make it more readable.</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Failure recovery example with BasicXARecovery</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/*
 * Some XAResourceRecovery implementations will do their startup work here,
 * and then do little or nothing in setDetails. Since this one needs to know
 * dynamic class name, the constructor does nothing.
 */</span>

<span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> dbTag = <span class="string"><span class="delimiter">&quot;</span><span class="content">DB_</span><span class="delimiter">&quot;</span></span>;
<span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> urlTag = <span class="string"><span class="delimiter">&quot;</span><span class="content">_DatabaseURL</span><span class="delimiter">&quot;</span></span>;
<span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> passwordTag = <span class="string"><span class="delimiter">&quot;</span><span class="content">_DatabasePassword</span><span class="delimiter">&quot;</span></span>;
<span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> userTag = <span class="string"><span class="delimiter">&quot;</span><span class="content">_DatabaseUser</span><span class="delimiter">&quot;</span></span>;
<span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> dynamicClassTag = <span class="string"><span class="delimiter">&quot;</span><span class="content">_DatabaseDynamicClass</span><span class="delimiter">&quot;</span></span>;
<span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> jndiTag = <span class="string"><span class="delimiter">&quot;</span><span class="content">JNDI_</span><span class="delimiter">&quot;</span></span>;
<span class="comment">/*
 * Example:
 *
 * DB2_DatabaseURL=jdbc\:arjuna\:sequelink\://qa02\:20001
 * DB2_DatabaseUser=tester2 DB2_DatabasePassword=tester
 * DB2_DatabaseDynamicClass=com.arjuna.ats.internal.jdbc.drivers.sequelink_5_1
 *
 * DB_JNDI_DatabaseURL=jdbc\:arjuna\:jndi DB_JNDI_DatabaseUser=tester1
 * DB_JNDI_DatabasePassword=tester DB_JNDI_DatabaseName=empay
 * DB_JNDI_Host=qa02 DB_JNDI_Port=20000
 */</span>
<span class="comment">// delimiter for parameters</span>
<span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">char</span> BREAKCHARACTER = <span class="string"><span class="delimiter">'</span><span class="content">;</span><span class="delimiter">'</span></span>;
<span class="directive">private</span> <span class="type">int</span> numberOfConnections;
<span class="directive">private</span> <span class="type">int</span> connectionIndex;
<span class="directive">private</span> <span class="predefined-type">Properties</span> props;
<span class="directive">public</span> BasicXARecovery() <span class="directive">throws</span> <span class="exception">SQLException</span> {
    numberOfConnections = <span class="integer">1</span>;
    connectionIndex = <span class="integer">0</span>;
    props = <span class="predefined-constant">null</span>;
}

<span class="comment">/**
 * The recovery module will have chopped off this class name already. The
 * parameter should specify a property file from which the url, user name,
 * password, etc. can be read.
 *
 * @message com.arjuna.ats.internal.jdbc.recovery.initexp An exception
 * occurred during initialisation.
 */</span>

<span class="directive">public</span> <span class="type">boolean</span> initialise(<span class="predefined-type">String</span> parameter) <span class="directive">throws</span> <span class="exception">SQLException</span> {
    <span class="keyword">if</span> (parameter == <span class="predefined-constant">null</span>)
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;

    <span class="type">int</span> breakPosition = parameter.indexOf(BREAKCHARACTER);
    <span class="predefined-type">String</span> fileName = parameter;

    <span class="keyword">if</span> (breakPosition != -<span class="integer">1</span>) {
        fileName = parameter.substring(<span class="integer">0</span>, breakPosition - <span class="integer">1</span>);

        <span class="keyword">try</span> {
            numberOfConnections = <span class="predefined-type">Integer</span>.parseInt(parameter.substring(breakPosition + <span class="integer">1</span>));
        } <span class="keyword">catch</span> (<span class="exception">NumberFormatException</span> e) {
            <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        }
    }

    <span class="keyword">try</span> {
        <span class="predefined-type">String</span> uri = com.arjuna.common.util.FileLocator.locateFile(fileName);
        jdbcPropertyManager.propertyManager.load(XMLFilePlugin.class.getName(), uri);

        props = jdbcPropertyManager.propertyManager.getProperties();
    } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
        <span class="keyword">return</span> <span class="predefined-constant">false</span>;
    }

    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
}

<span class="comment">/**
 * @message com.arjuna.ats.internal.jdbc.recovery.xarec {0} could not find
 * information for connection!
 */</span>

<span class="directive">public</span> <span class="directive">synchronized</span> <span class="predefined-type">XAResource</span> getXAResource() <span class="directive">throws</span> <span class="exception">SQLException</span> {
    JDBC2RecoveryConnection conn = <span class="predefined-constant">null</span>;

    <span class="keyword">if</span> (hasMoreResources()) {
        connectionIndex++;

        conn = getStandardConnection();

        <span class="keyword">if</span> (conn == <span class="predefined-constant">null</span>) conn = getJNDIConnection();
    }

    <span class="keyword">return</span> conn.recoveryConnection().getConnection().getXAResource();
}

<span class="directive">public</span> <span class="directive">synchronized</span> <span class="type">boolean</span> hasMoreResources() {
    <span class="keyword">if</span> (connectionIndex == numberOfConnections)
        <span class="keyword">return</span> <span class="predefined-constant">false</span>;
    <span class="keyword">else</span>
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
}

<span class="directive">private</span> <span class="directive">final</span> JDBC2RecoveryConnection getStandardConnection() <span class="directive">throws</span> <span class="exception">SQLException</span> {
    <span class="predefined-type">String</span> number = <span class="keyword">new</span> <span class="predefined-type">String</span>(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> + connectionIndex);
    <span class="predefined-type">String</span> url = <span class="keyword">new</span> <span class="predefined-type">String</span>(dbTag + number + urlTag);
    <span class="predefined-type">String</span> password = <span class="keyword">new</span> <span class="predefined-type">String</span>(dbTag + number + passwordTag);
    <span class="predefined-type">String</span> user = <span class="keyword">new</span> <span class="predefined-type">String</span>(dbTag + number + userTag);
    <span class="predefined-type">String</span> dynamicClass = <span class="keyword">new</span> <span class="predefined-type">String</span>(dbTag + number + dynamicClassTag);

    <span class="predefined-type">Properties</span> dbProperties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();

    <span class="predefined-type">String</span> theUser = props.getProperty(user);
    <span class="predefined-type">String</span> thePassword = props.getProperty(password);

    <span class="keyword">if</span> (theUser != <span class="predefined-constant">null</span>) {
        dbProperties.put(TransactionalDriver.userName, theUser);
        dbProperties.put(TransactionalDriver.password, thePassword);

        <span class="predefined-type">String</span> dc = props.getProperty(dynamicClass);

        <span class="keyword">if</span> (dc != <span class="predefined-constant">null</span>)
            dbProperties.put(TransactionalDriver.dynamicClass, dc);

        <span class="keyword">return</span> <span class="keyword">new</span> JDBC2RecoveryConnection(url, dbProperties);
    } <span class="keyword">else</span>
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
}

<span class="directive">private</span> <span class="directive">final</span> JDBC2RecoveryConnection getJNDIConnection() <span class="directive">throws</span> <span class="exception">SQLException</span> {
    <span class="predefined-type">String</span> number = <span class="keyword">new</span> <span class="predefined-type">String</span>(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> + connectionIndex);
    <span class="predefined-type">String</span> url = <span class="keyword">new</span> <span class="predefined-type">String</span>(dbTag + jndiTag + number + urlTag);
    <span class="predefined-type">String</span> password = <span class="keyword">new</span> <span class="predefined-type">String</span>(dbTag + jndiTag + number + passwordTag);
    <span class="predefined-type">String</span> user = <span class="keyword">new</span> <span class="predefined-type">String</span>(dbTag + jndiTag + number + userTag);

    <span class="predefined-type">Properties</span> dbProperties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();

    <span class="predefined-type">String</span> theUser = props.getProperty(user);
    <span class="predefined-type">String</span> thePassword = props.getProperty(password);

    <span class="keyword">if</span> (theUser != <span class="predefined-constant">null</span>) {
        dbProperties.put(TransactionalDriver.userName, theUser);
        dbProperties.put(TransactionalDriver.password, thePassword);

        <span class="keyword">return</span> <span class="keyword">new</span> JDBC2RecoveryConnection(url, dbProperties);
    } <span class="keyword">else</span>
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the class <code>com.arjuna.ats.internal.jdbc.recovery.JDBC2RecoveryConnection</code> to create a new connection to the database using the same parameters used to create the initial connection.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-09-27 14:38:03 +0100
</div>
</div>
</body>
</html>